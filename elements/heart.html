<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heart Animation</title>
<style>
    body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: #fff;
        margin: 0;
    }
    canvas {
        background: transparent;
    }
</style>
</head>
<body>

<canvas id="garden" width="300" height="300"></canvas>

<script>
// === Vector ===
function Vector(x,y){ this.x=x; this.y=y; }
Vector.prototype = {
    rotate: function(theta){ var x=this.x, y=this.y; this.x=Math.cos(theta)*x-Math.sin(theta)*y; this.y=Math.sin(theta)*x+Math.cos(theta)*y; return this; },
    mult: function(f){ this.x*=f; this.y*=f; return this; },
    clone: function(){ return new Vector(this.x,this.y); }
};

// === Petal ===
function Petal(stretchA,stretchB,startAngle,angle,growFactor,bloom){
    this.stretchA=stretchA; this.stretchB=stretchB;
    this.startAngle=startAngle; this.angle=angle; this.bloom=bloom;
    this.r=1; this.isfinished=false; this.growFactor=growFactor;
}
Petal.prototype.draw = function(){
    var ctx=this.bloom.garden.ctx;
    var v1 = new Vector(0,this.r).rotate(Garden.degrad(this.startAngle));
    var v2 = v1.clone().rotate(Garden.degrad(this.angle));
    var v3 = v1.clone().mult(this.stretchA);
    var v4 = v2.clone().mult(this.stretchB);
    ctx.strokeStyle=this.bloom.c;
    ctx.beginPath();
    ctx.moveTo(v1.x,v1.y);
    ctx.bezierCurveTo(v3.x,v3.y,v4.x,v4.y,v2.x,v2.y);
    ctx.stroke();
};
Petal.prototype.render=function(){
    if(this.r <= this.bloom.r){ this.r+=this.growFactor; this.draw(); }
    else this.isfinished=true;
};

// === Bloom ===
function Bloom(p,r,c,pc,garden){ 
    this.p=p; this.r=r; this.c=c; this.pc=pc; this.petals=[]; this.garden=garden; 
    this.init(); this.garden.addBloom(this);
}
Bloom.prototype.init=function(){
    var angle=360/this.pc, startAngle=Math.random()*90;
    for(var i=0;i<this.pc;i++){
        this.petals.push(new Petal(
            Math.random()*2+0.1, Math.random()*2+0.1, 
            startAngle+i*angle, angle, 
            Math.random()*0.9+0.1, this
        ));
    }
};
Bloom.prototype.draw=function(){
    var p, finished=true;
    this.garden.ctx.save();
    this.garden.ctx.translate(this.p.x,this.p.y);
    for(var i=0;i<this.petals.length;i++){
        p=this.petals[i];
        p.render();
        finished *= p.isfinished;
    }
    this.garden.ctx.restore();
    if(finished) this.garden.removeBloom(this);
};

// === Garden ===
function Garden(ctx){ this.blooms=[]; this.ctx=ctx; }
Garden.prototype={
    render:function(){ for(var i=0;i<this.blooms.length;i++) this.blooms[i].draw(); },
    addBloom:function(b){ this.blooms.push(b); },
    removeBloom:function(b){ 
        var idx=this.blooms.indexOf(b); if(idx>-1) this.blooms.splice(idx,1); 
    },
    createRandomBloom:function(x,y){
        this.createBloom(x,y,Math.random()*3+4, `rgba(${128+Math.random()*127},0,${Math.random()*128},0.6)`, Math.floor(Math.random()*7+8));
    },
    createBloom:function(x,y,r,c,pc){ new Bloom(new Vector(x,y),r,c,pc,this); }
};
Garden.circle = 2*Math.PI;
Garden.degrad = function(angle){ return Garden.circle/360*angle; };

var canvas = document.getElementById('garden');
var ctx = canvas.getContext('2d');
var garden = new Garden(ctx);

// === Heart Shape Points ===
function getHeartPoint(angle){
    var t = angle/180*Math.PI;
    var x = 160*16*Math.pow(Math.sin(t),3);
    var y = -160*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
    return [150 + x/20, 150 + y/20];
}

// === Animation ===
function startHeartAnimation(){
    var angle = 0, heart=[];
    var interval = setInterval(function(){
        var bloom = getHeartPoint(angle);
        var draw=true;
        for(var i=0;i<heart.length;i++){
            var p = heart[i];
            if(Math.hypot(p[0]-bloom[0],p[1]-bloom[1])<6){ draw=false; break; }
        }
        if(draw){ heart.push(bloom); garden.createRandomBloom(bloom[0],bloom[1]); }
        angle++; 
        if(angle>360) clearInterval(interval);
        garden.render();
    }, 10);
}

startHeartAnimation();
</script>

</body>
</html>
