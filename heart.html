<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heart & Petal Animation</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: linear-gradient(to bottom, #ffccdd, #eeccff);

     /*   background: #f7cad9; /* Pinkish background */
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: sans-serif;
    }
    canvas {
        position: absolute;
        top: 0;
        left: 0;
    }
    #playMusic {
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        background: rgba(255,255,255,0.7);
        border-radius: 8px;
        cursor: pointer;
    }
</style>
</head>
<body>

<audio id="softMusic" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>
<button id="playMusic">Play Soft Music ðŸŽµ</button>

<canvas id="garden"></canvas>
<canvas id="petals"></canvas>

<script>
// === Play Music ===
const musicBtn = document.getElementById('playMusic');
const music = document.getElementById('softMusic');
musicBtn.addEventListener('click', () => {
    music.play();
    musicBtn.style.display = 'none';
});

// === Canvas Setup ===
const canvas = document.getElementById('garden');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const petalCanvas = document.getElementById('petals');
const pctx = petalCanvas.getContext('2d');
petalCanvas.width = window.innerWidth;
petalCanvas.height = window.innerHeight;

// === Heart Animation Classes ===
function Vector(x,y){ this.x=x; this.y=y; }
Vector.prototype = {
    rotate: function(theta){ var x=this.x, y=this.y; this.x=Math.cos(theta)*x-Math.sin(theta)*y; this.y=Math.sin(theta)*x+Math.cos(theta)*y; return this; },
    mult: function(f){ this.x*=f; this.y*=f; return this; },
    clone: function(){ return new Vector(this.x,this.y); }
};

function PetalShape(stretchA,stretchB,startAngle,angle,growFactor,bloom){
    this.stretchA=stretchA; this.stretchB=stretchB;
    this.startAngle=startAngle; this.angle=angle; this.bloom=bloom;
    this.r=1; this.isfinished=false; this.growFactor=growFactor;
}
PetalShape.prototype.draw = function(){
    var ctx=this.bloom.garden.ctx;
    var v1 = new Vector(0,this.r).rotate(Garden.degrad(this.startAngle));
    var v2 = v1.clone().rotate(Garden.degrad(this.angle));
    var v3 = v1.clone().mult(this.stretchA);
    var v4 = v2.clone().mult(this.stretchB);
    ctx.strokeStyle=this.bloom.c;
    ctx.beginPath();
    ctx.moveTo(v1.x,v1.y);
    ctx.bezierCurveTo(v3.x,v3.y,v4.x,v4.y,v2.x,v2.y);
    ctx.stroke();
};
PetalShape.prototype.render=function(){
    if(this.r <= this.bloom.r){ this.r+=this.growFactor; this.draw(); }
    else this.isfinished=true;
};

function Bloom(p,r,c,pc,garden){ 
    this.p=p; this.r=r; this.c=c; this.pc=pc; this.petals=[]; this.garden=garden; 
    this.init(); this.garden.addBloom(this);
}
Bloom.prototype.init=function(){
    var angle=360/this.pc, startAngle=Math.random()*90;
    for(var i=0;i<this.pc;i++){
        this.petals.push(new PetalShape(
            Math.random()*2+0.1, Math.random()*2+0.1, 
            startAngle+i*angle, angle, 
            Math.random()*0.9+0.1, this
        ));
    }
};
Bloom.prototype.draw=function(){
    var p, finished=true;
    this.garden.ctx.save();
    this.garden.ctx.translate(this.p.x,this.p.y);
    for(var i=0;i<this.petals.length;i++){
        p=this.petals[i];
        p.render();
        finished *= p.isfinished;
    }
    this.garden.ctx.restore();
    if(finished) this.garden.removeBloom(this);
};

function Garden(ctx){ this.blooms=[]; this.ctx=ctx; }
Garden.prototype={
    render:function(){ for(var i=0;i<this.blooms.length;i++) this.blooms[i].draw(); },
    addBloom:function(b){ this.blooms.push(b); },
    removeBloom:function(b){ 
        var idx=this.blooms.indexOf(b); if(idx>-1) this.blooms.splice(idx,1); 
    },
    //color
//    this.createBloom(x,y,Math.random()*3+4, rgba(${128+Math.random()*127},0,${Math.random()*128},0.6), Math.floor(Math.random()*7+8));
    createRandomBloom:function(x,y){
        // ORIGINAL COLORS: purples and greens like your first animation
        let r = Math.floor(Math.random()*128+128);
        let g = Math.floor(Math.random()*12);
        let b = Math.floor(Math.random()*128);
        let a = 0.6;
        let color = `rgba(${r},${g},${b},${a})`;
        let radius = Math.random() * 4+ 7;           // r = 4â€“7
    let petalCount = Math.floor(Math.random() * 4 + 8); // pc = 8â€“14

    this.createBloom(x, y, radius, color, petalCount);   },
    createBloom:function(x,y,r,c,pc){ new Bloom(new Vector(x,y),r,c,pc,this); }
};
Garden.circle = 2*Math.PI;
Garden.degrad = function(angle){ return Garden.circle/360*angle; };

const garden = new Garden(ctx);

//size
function getHeartPoint(angle){
    var t = angle/180*Math.PI;
    var x = 160*16*Math.pow(Math.sin(t),3);
    var y = -160*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
    return [window.innerWidth/2 + x/15, window.innerHeight/2 + y/15];
}

function startHeartAnimation(){
    var angle = 0, heart=[];
    var interval = setInterval(function(){
        var bloom = getHeartPoint(angle);
        var draw=true;
        for(var i=0;i<heart.length;i++){
            var p = heart[i];
            if(Math.hypot(p[0]-bloom[0],p[1]-bloom[1])<6){ draw=false; break; }
        }
        if(draw){ heart.push(bloom); garden.createRandomBloom(bloom[0],bloom[1]); }
        angle++; 
        if(angle>360) clearInterval(interval);
        garden.render();
    }, 10);
}

// === Falling Petals ===
let petals = [];
function createPetals() {
    for(let i=0;i<100;i++){
        petals.push({
            x: Math.random()*window.innerWidth,
            y: Math.random()*-window.innerHeight,
            r: Math.random()*7+2, //size
            d: Math.random()*1+1,//speed
            color: `rgba(255, ${Math.floor(Math.random()*50+150)}, ${Math.floor(Math.random()*50+150)}, 0.7)`,
            sway: Math.random()*2
        });
    }
}
function drawPetals() {
    pctx.clearRect(0,0,petalCanvas.width,petalCanvas.height);
    for(let i=0;i<petals.length;i++){
        let p = petals[i];
        p.y += p.d;
        p.x += Math.sin(p.y*0.01)*p.sway;
        if(p.y>window.innerHeight) p.y=-10;
        pctx.beginPath();
        pctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        pctx.fillStyle = p.color;
        pctx.fill();
    }
    requestAnimationFrame(drawPetals);
}

createPetals();
drawPetals();
startHeartAnimation();

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    petalCanvas.width = window.innerWidth;
    petalCanvas.height = window.innerHeight;
});
</script>
</body>
</html>
